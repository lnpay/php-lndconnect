<?php

/*
 * The MIT License (MIT)
 *
 * Copyright (c) 2020 tkijewski (@BootstrapBandit)
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE file for details.
 */

namespace LndConnect\Test;


use LndConnect\LndConnect;
use PHPUnit\Framework\TestCase;

class LndConnectTest extends TestCase
{
    const HOST = '127.0.0.1:10001';
    const RAW_CERT = "-----BEGIN CERTIFICATE-----
MIICDjCCAbSgAwIBAgIRAM0roywH17AC/bKHv1mabUkwCgYIKoZIzj0EAwIwMTEf
MB0GA1UEChMWbG5kIGF1dG9nZW5lcmF0ZWQgY2VydDEOMAwGA1UEAxMFYWxpY2Uw
HhcNMjAwNzE3MjM1NzM0WhcNMjEwOTExMjM1NzM0WjAxMR8wHQYDVQQKExZsbmQg
YXV0b2dlbmVyYXRlZCBjZXJ0MQ4wDAYDVQQDEwVhbGljZTBZMBMGByqGSM49AgEG
CCqGSM49AwEHA0IABLLFy5uIrn8Z+wPA9bW3KgJx8wHfNhee/hABiQeB4h1+Lbyx
NCQ7oHs3ZQwknpQx0M6ImJc+5DrlB7hlGzChiTGjgawwgakwDgYDVR0PAQH/BAQD
AgKkMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA8GA1UdEwEB/wQFMAMBAf8wcQYDVR0R
BGowaIIFYWxpY2WCCWxvY2FsaG9zdIIFYWxpY2WCDnBvbGFyLW4yLWFsaWNlggR1
bml4ggp1bml4cGFja2V0ggdidWZjb25uhwR/AAABhxAAAAAAAAAAAAAAAAAAAAAB
hwSsEgAEhwTAqEUBMAoGCCqGSM49BAMCA0gAMEUCIEs3klQsnshGFYeeE2y357JN
2VTkkQOKwsD8KNTYnZtlAiEAyOPhO5k1F+E/o5TKb6ZJLtaFFXcWY/EBGWIWKOEd
xSk=
-----END CERTIFICATE-----";

    const HEX_MACAROON = '0201036c6e6402eb01030a10481c4e178943a99871b5692f386297541201301a160a0761646472657373120472656164120577726974651a130a04696e666f120472656164120577726974651a170a08696e766f69636573120472656164120577726974651a140a086d616361726f6f6e120867656e65726174651a160a076d657373616765120472656164120577726974651a170a086f6666636861696e120472656164120577726974651a160a076f6e636861696e120472656164120577726974651a140a057065657273120472656164120577726974651a180a067369676e6572120867656e6572617465120472656164000006209041124edcc55e8ab00ddc5b226bf7acc1056cee4f527d376271b9c52f1c8ff9';

    const LNDCONNECT_URI = 'lndconnect://127.0.0.1:10001?cert=MIICDjCCAbSgAwIBAgIRAM0roywH17AC_bKHv1mabUkwCgYIKoZIzj0EAwIwMTEfMB0GA1UEChMWbG5kIGF1dG9nZW5lcmF0ZWQgY2VydDEOMAwGA1UEAxMFYWxpY2UwHhcNMjAwNzE3MjM1NzM0WhcNMjEwOTExMjM1NzM0WjAxMR8wHQYDVQQKExZsbmQgYXV0b2dlbmVyYXRlZCBjZXJ0MQ4wDAYDVQQDEwVhbGljZTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABLLFy5uIrn8Z-wPA9bW3KgJx8wHfNhee_hABiQeB4h1-LbyxNCQ7oHs3ZQwknpQx0M6ImJc-5DrlB7hlGzChiTGjgawwgakwDgYDVR0PAQH_BAQDAgKkMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA8GA1UdEwEB_wQFMAMBAf8wcQYDVR0RBGowaIIFYWxpY2WCCWxvY2FsaG9zdIIFYWxpY2WCDnBvbGFyLW4yLWFsaWNlggR1bml4ggp1bml4cGFja2V0ggdidWZjb25uhwR_AAABhxAAAAAAAAAAAAAAAAAAAAABhwSsEgAEhwTAqEUBMAoGCCqGSM49BAMCA0gAMEUCIEs3klQsnshGFYeeE2y357JN2VTkkQOKwsD8KNTYnZtlAiEAyOPhO5k1F-E_o5TKb6ZJLtaFFXcWY_EBGWIWKOEdxSk&macaroon=AgEDbG5kAusBAwoQSBxOF4lDqZhxtWkvOGKXVBIBMBoWCgdhZGRyZXNzEgRyZWFkEgV3cml0ZRoTCgRpbmZvEgRyZWFkEgV3cml0ZRoXCghpbnZvaWNlcxIEcmVhZBIFd3JpdGUaFAoIbWFjYXJvb24SCGdlbmVyYXRlGhYKB21lc3NhZ2USBHJlYWQSBXdyaXRlGhcKCG9mZmNoYWluEgRyZWFkEgV3cml0ZRoWCgdvbmNoYWluEgRyZWFkEgV3cml0ZRoUCgVwZWVycxIEcmVhZBIFd3JpdGUaGAoGc2lnbmVyEghnZW5lcmF0ZRIEcmVhZAAABiCQQRJO3MVeirAN3Fsia_eswQVs7k9SfTdicbnFLxyP-Q';

    public function testEncode(): void
    {
        $encoded = LndConnect::encode(self::HOST,self::RAW_CERT,self::HEX_MACAROON);
        static::assertEquals(self::LNDCONNECT_URI, $encoded);
    }
}